# Notes -- Log4j Exploit Detection (Microsoft Sentinel)

This file contains additional observations, considerations, and insights
gathered during the implementation of the Log4j (Log4Shell) exploit
detection project in Microsoft Sentinel.

------------------------------------------------------------------------

## üìå General Observations

-   The **Log4j Vulnerability Detection** solution installs multiple
    components, but the most relevant for this project is the *Log4Shell
    IP IOC scheduled analytics rule template*.
-   The solution relies heavily on **ThreatIntelligenceIndicator** data,
    so ensuring that TI feeds are active and updated is essential.
-   Log sources such as **AzureDiagnostics**, **CommonSecurityLog**, and
    **SigninLogs** provide broad coverage for detecting inbound
    connections.

------------------------------------------------------------------------

## üìä Query Logic Insights

-   The KQL query effectively correlates source IP addresses with known
    **Log4j-related IOCs**.
-   Using `union isfuzzy=true` ensures Sentinel checks multiple log
    sources without strict schema alignment.
-   `AccountCustomEntity` and `IPCustomEntity` mappings help SOC teams
    quickly identify key entities in incidents.

------------------------------------------------------------------------

## üîé Important Considerations

-   Accuracy of detections depends on the freshness of **threat
    intelligence IOCs**. If TI updates stop, detections weaken.
-   Log sources must be properly connected to Sentinel; **missing
    connectors = gaps in detection**.
-   Custom details (like timestamps) significantly improve readability
    and analyst context during investigations.

------------------------------------------------------------------------

## ‚ö†Ô∏è Limitations

-   IOC-based detection alone cannot identify all Log4j exploitation
    attempts; attackers may use new or unlisted IPs.
-   The rule does not include payload analysis; it is **indicator-only
    detection**.
-   Environments with low logging may fail to capture enough data for
    detections.

------------------------------------------------------------------------

## üéØ Recommendations for Enhancement

Add secondary detection rules using **pattern-based or anomaly-based
analytics** focused on: - Suspicious Java processes\
- Unusual LDAP/RMI requests\
- Outbound connections triggered by JVM processes

Integrate additional TI sources for broader Log4Shell coverage.

Pair this rule with: - Hunting queries\
- Workbook dashboards\
- Automated enrichment playbooks (Logic Apps)

------------------------------------------------------------------------

## üí° Learning Outcomes

This project reinforced practical skills in: - Using Microsoft Sentinel
rule templates\
- Customizing KQL queries for threat detection\
- Enhancing alerts with contextual metadata\
- Automating incident triage with tags\
- Understanding IOC-based detection challenges\
- Applying SOC principles to real-world vulnerabilities
